# Сетевые настройки
# Стандартный порт Redis
port 6379
# Слушаем все интерфейсы (ограничивать на уровне файрвола)
bind 0.0.0.0
# Включаем защищенный режим
protected-mode yes

# Настройки аутентификации
# Пароль для доступа (задается через переменные окружения)
requirepass ${REDIS_PASSWORD}
# Отключаем опасные команды
rename-command FLUSHALL ""
rename-command FLUSHDB ""
rename-command CONFIG ""

# Настройки сохранения данных
# Включаем AOF для надежности (AOF - журнал изменений)
appendonly yes
# Синхронизация каждую секунду (баланс между производительностью и надежностью)
appendfsync everysec

# Настройки RDB (RDB - снимок базы данных)
# Сохранять если 1 ключ изменился за 15 минут
save 900 1
# Сохранять если 10 ключей изменились за 5 минут
save 300 10
# Сохранять если 10000 ключей изменились за 1 минуту
save 60 10000

# Управление памятью
# Максимальный размер памяти
maxmemory 2gb
# Удалять только ключи с TTL по LRU
maxmemory-policy volatile-lru
# Количество образцов для LRU алгоритма
maxmemory-samples 5

# Оптимизация памяти
# Постепенное перехеширование для экономии CPU
activerehashing yes
# Асинхронное удаление ключей
lazyfree-lazy-eviction yes

# Настройки логирования
# Уровень логирования для прода
loglevel notice
# Путь к файлу логов (в директории, где у redis есть права)
logfile /data/redis.log

# Ограничения клиентов
# Максимальное количество одновременных подключений
maxclients 10000
# Таймаут неактивного соединения в секундах
timeout 300

# Настройки баз данных
# Количество доступных баз данных
databases 16

# TCP keepalive
# Проверка живости соединений каждые 5 минут
tcp-keepalive 300